# 💹 AlphaQuant · ETL → Machine Learning → KPIs & Visuals
![CI](https://github.com/ShadowBlack33/ia-financiera/actions/workflows/ci.yml/badge.svg)

[![Python](https://img.shields.io/badge/Python-3.10%2B-3776AB)](https://www.python.org/)
[![pandas](https://img.shields.io/badge/pandas-2.x-150458)](https://pandas.pydata.org/)
[![scikit-learn](https://img.shields.io/badge/scikit--learn-1.x-f7931e)](https://scikit-learn.org/)
[![streamlit](https://img.shields.io/badge/Streamlit-Dashboard-E64A19)](https://streamlit.io/)

**AlphaQuant** is an end-to-end financial machine learning project that extracts and transforms OHLCV time series, engineers technical indicators, trains ensemble models, and produces **UP/DOWN** predictions with KPIs and interactive dashboards.

> Data source: **Yahoo Finance** via `yfinance`.  
> Visuals and predictions are generated from the transformed dataset (not from raw data).  
> **Author**: Carlos Andrés Orozco Caicedo 🇨🇴

---

## 🧭 Table of Contents

- [🎯 Goal](#-goal)
- [🖼️ Preview](#-preview)
- [✨ Features](#-features)
- [🏗️ Architecture](#-architecture)
- [🧱 Star Schema](#-star-schema)
- [📚 Data Dictionary](#-data-dictionary)
- [⚙️ Install & Run](#️-install--run)
- [🧾 Configuration (`config.yaml`)](#-configuration-configyaml)
- [📊 KPIs & Model Details](#-kpis--model-details)
- [🖥️ Dashboard](#-dashboard)
- [📈 Backtest (optional)](#-backtest-optional)
- [🔁 Reproducibility & CI](#-reproducibility--ci)
- [🛠️ Troubleshooting](#-troubleshooting)
- [🗺️ Roadmap](#-roadmap)
- [📜 License & Disclaimer](#-license--disclaimer)
- [👤 Author](#-author)

---

## 🎯 Goal

- Predict financial market direction (UP/DOWN) from OHLCV data.
- Build a clean ETL + ML pipeline with model ensembles and dashboards.
- Produce ranked signals, summary metrics, and performance visuals.
- Ensure full reproducibility with CI/CD automation.

---

## 🖼️ Preview

<p align="center">
  <img src="images/heatmap_probs.png" alt="Probability Heatmap (Ensemble / Models)" width="70%" />
</p>

<p align="center">
  <em>Generated by <code>scripts/plot_heatmap.py</code> → <code>images/heatmap_probs.png</code></em>
</p>

---

## ✨ Features

- 🔁 ETL from Yahoo Finance
- 🧪 Technical indicators: RSI, MACD, SMA, EMA, Bollinger, ATR, etc.
- 🤖 Ensemble classifier: LogisticRegression + RandomForest → `PROBA_UP`
- 📊 Top-N bullish/bearish assets with CSV summary
- 🌡️ Heatmap of ensemble probabilities
- 🖥️ Streamlit dashboard (optional)
- 📄 Logging, automated reports, console highlights
- ✅ CI with smoke tests and backtest integration

---

## 🏗️ Architecture

### 🔄 Data Flow

```mermaid
flowchart LR
  A[yfinance tickers] --> B[etl/extract.py]
  B --> C[etl/transform.py]
  C --> D[etl/load.py]
  D --> R[data/raw/*.csv]
  R --> E[models/train_all.py]
  R --> F[models/train_direction.py]
  F --> S[models/prob_summary.csv]
  F --> T[models/traces/*.csv]
  S --> H[images/heatmap_probs.png]
  S --> W[apps/dashboard_app.py]
````

---

## 🧱 Star Schema

```mermaid
erDiagram
  SIGNALS {
    datetime datetime
    string   ticker
    float    proba_logreg
    float    proba_rf
    float    proba_ens
    string   pred
  }

  TICKER {
    string ticker
    string asset_class
  }

  DATE {
    datetime datetime
    int      year
    int      month
    int      day
  }

  MODEL {
    string name
    string type
    string notes
  }

  SIGNALS ||--o{ TICKER : has
  SIGNALS ||--o{ DATE   : occurs_on
  SIGNALS ||--o{ MODEL  : generated_by
```

---

## 📚 Data Dictionary

### `models/prob_summary.csv`

| Column         | Type   | Description                             |
| -------------- | ------ | --------------------------------------- |
| `ticker`       | string | Symbol (e.g., SPY, AAPL, BTC-USD)       |
| `date`         | date   | Date of prediction                      |
| `proba_logreg` | float  | Probability of UP (Logistic Regression) |
| `proba_rf`     | float  | Probability of UP (Random Forest)       |
| `proba_ens`    | float  | Ensemble probability (weighted avg)     |
| `pred`         | string | Final direction: `UP` / `DOWN`          |

---

## ⚙️ Install & Run

```bash
# 1. Clone
git clone https://github.com/ShadowBlack33/ia-financiera.git
cd ia-financiera

# 2. Virtual env
python -m venv .venv
.venv\Scripts\activate           # Windows
# source .venv/bin/activate      # macOS/Linux

# 3. Install dependencies
pip install -r requirements.txt

# 4. Run full pipeline (ETL → Train → Predict)
python menu.py

# 5. Generate heatmap preview
python scripts/plot_heatmap.py
```

---

## 🧾 Configuration (`config.yaml`)

```yaml
start_date: "2015-01-01"
end_date: ""            # empty = up to latest
interval: "1d"

data_dir: "data/raw"
default_top_n: 10

features:
  rsi:
    periods: [14]
  macd:
    fast: 12
    slow: 26
    signal: 9
  sma:
    windows: [10, 20, 50, 200]
  ema:
    windows: [12, 26]
  bollinger:
    window: 20
    n_std: 2
  atr:
    window: 14
```

---

## 📊 KPIs & Model Details

* **PROBA\_UP (ensemble):** weighted average of model probabilities
* **Top-N Calls/Puts:** ranks tickers by `proba_ens` (descending/ascending)
* **Console colors:** highlights UP/DOWN rows for fast scanning
* **Hold-out split strategy:** last `N` samples reserved (e.g., 200)
* **Optional embargo window** for leakage prevention

---

## 🖥️ Dashboard

```bash
streamlit run apps/dashboard_app.py
```

Features:

* Top-N bullish & bearish lists
* Probability heatmap (LogReg / RF / Ensemble)
* Summary data table

---

## 📈 Backtest

```bash
python -m models.backtest
```

Outputs:

* CSV summaries in `reports/`
* Traces per ticker in `models/traces/`
* Optional plots if trace files exist

---

## 🔁 Reproducibility & CI

* ✅ `config.yaml` for full pipeline configuration
* ✅ `.gitignore` prevents uploading large artifacts
* ✅ GitHub Actions CI:

  * Runs `models/backtest_ci.py` on a sample
  * Runs `tests/test_smoke.py` for smoke check
  * Uploads `backtest-ci-report.csv` as artifact

CI Badge:

![CI](https://github.com/ShadowBlack33/ia-financiera/actions/workflows/ci.yml/badge.svg)

---

## 🛠️ Troubleshooting

| Issue                   | Suggestion                                          |
| ----------------------- | --------------------------------------------------- |
| Mermaid not rendered    | Ensure fenced code blocks use `mermaid`             |
| Heatmap not appearing   | Run `plot_heatmap.py` and check `.gitignore` rules  |
| Dashboard error         | Run full pipeline before launching Streamlit app    |
| CI fails on import      | Only `test_smoke.py` runs in CI to avoid heavy deps |
| yfinance download fails | Retry or reduce ticker count/date range             |

---

## 🗺️ Roadmap

* [ ] Add XGBoost / LightGBM support
* [ ] Walk-forward cross-validation
* [ ] Advanced portfolio backtest metrics (Sharpe, drawdown)
* [ ] Streamlit Cloud / HuggingFace Spaces deployment
* [ ] Model registry and version tracking

---

## 📜 License & Disclaimer

**MIT License © 2025 – Carlos Andrés Orozco Caicedo**

> This repository is for educational and experimental purposes only.
> **It does not constitute financial advice. Use at your own risk.**

---

## 👤 Author

**Carlos Andrés Orozco Caicedo**
Data Engineering & Machine Learning · Colombia 🇨🇴

> Creator of AlphaQuant — full-stack ML pipeline with reproducibility, CI/CD, and real-time dashboards.
